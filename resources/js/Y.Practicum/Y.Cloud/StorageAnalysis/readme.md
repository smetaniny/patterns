# Руководство по управлению данными в Yandex Cloud

## Введение

Для принятия обоснованных решений бизнесу требуется собирать, обрабатывать и анализировать данные. Облачные технологии
позволяют быстро получать доступ к данным и экономить деньги, время и силы. В Yandex Cloud используются сервисы для
работы с данными, такие как PostgreSQL, MySQL, MongoDB и другие. Виртуализация баз данных имеет ряд преимуществ, таких
как более высокая доступность данных, быстрое добавление ресурсов и экономия средств.

## Развертывание баз данных в Yandex Cloud

В Yandex Cloud можно развернуть базы данных двумя способами:

1. Поверх виртуальных машин
2. С помощью сервисов управляемых баз данных

Использование управляемых баз данных позволяет сосредоточиться на приложении и не отвлекаться на администрирование
серверов и ПО.

## Основные понятия

### Кластеры

Использование управляемой базы данных в Yandex Cloud начинается с создания кластера.

### Масштабируемость

Управляемые базы данных решают проблему с помощью масштабирования.

### Доступность и отказоустойчивость

Сервисы управляемых баз данных помогут улучшить доступность приложения или сайта.

### Кластеры высокой доступности

Кластер можно настроить так, что любой хост автоматически станет мастером.

### Отказоустойчивость

Кластеры отказоустойчивы, если имеют избыточные ресурсы и размещены в разных зонах доступности.

### Выбор системы

Зависит от приоритетов: высокодоступная или отказоустойчивая.

## Типы баз данных

### Реляционные базы данных

- **Определение**: Набор таблиц и связей между ними.
- **Язык запросов**: SQL.
- **Популярные СУБД в Yandex Cloud**: MySQL и PostgreSQL.
- **Особенности**: Реляционные базы данных не всегда являются лучшим инструментом.

### Нереляционные (NoSQL) базы данных

- **Преимущества**: Высокая доступность, скорость работы и масштабируемость.
- **Популярные NoSQL базы данных**:
    - **MongoDB**: Популярная NoSQL СУБД с открытым исходным кодом, работает с документами и хорошо сочетается с
      JavaScript.
    - **Redis**: Хранилище данных типа key-value, работает с Lua скриптами, обеспечивает высокую производительность, но
      имеет ограничения.
    - **ClickHouse**: Столбцовая СУБД, хранит данные в таблицах, имеет высокую скорость работы, но не поддерживает
      транзакции.
    - **Elasticsearch**: Нереляционное хранилище данных, хорошо масштабируется, но не обеспечивает транзакционную
      целостность.
    - **YDB**: Разработанная Яндексом распределенная СУБД, основана на реляционной модели, обеспечивает
      отказоустойчивость и масштабируемость.
    - **Apache Kafka**: Распределенная стриминговая платформа, обеспечивает надежность передачи данных между сервисами.

## Выбор базы данных

Универсальной базы данных не существует, выбор зависит от задачи. На выбор базы данных влияют особенности задачи и
предпочтения разработчика. Факторы для выбора базы данных: масштабируемость, структура данных, необходимость транзакций,
сложность аналитических запросов, работа под смешанной нагрузкой. Управляемые базы данных имеют преимущества перед
традиционными базами данных.

## Объектное хранилище

Объектное хранилище - облачная система хранения данных произвольного формата, подходящая для хранения видеозаписей,
изображений, архивов и резервных копий. Объектное хранилище обеспечивает доступность данных, их защиту от
несанкционированного доступа и масштабируемость. Идентификатор объекта - строка, используемая для идентификации объектов
в хранилище, а метаданные содержат дополнительные сведения. Объекты в хранилище группируются в бакеты, что позволяет
разделять данные разных проектов или пользователей. Объектные хранилища имеют некоторые особенности, такие как
взаимодействие с приложениями через HTTP API и невозможность редактирования объектов. В Yandex Cloud доступны три класса
хранилищ: стандартное, холодное и ледяное, с разными тарифами на хранение и обращение к данным. S3-совместимость
позволяет использовать популярные инструменты для работы с S3-протоколом, такие как S3cmd, AWS CLI, Cyberduck, WinSCP,
SDK для Python и Java. Объектное хранилище имеет преимущества, такие как масштабируемость, высокая производительность,
отказоустойчивость, метаданные и низкая стоимость хранения данных.


Управление доступом к рентгеновским снимкам в облаке важно для обеспечения врачебной тайны.
В Yandex Cloud используются три независимых механизма контроля доступа: сервис управления доступом (IAM), список управления доступом (ACL) и политика доступа (Bucket Policy).
IAM проверяет все операции в облаке и управляет доступом на основе ролей.
ACL позволяет разрешать операции чтения, записи, перезаписи и удаления объектов.
Политика доступа настраивает дополнительные условия действий с бакетами и объектами.
Механизмы контроля доступа применяются в порядке: проверка через IAM, политика доступа и ACL.
Подписанные ссылки предоставляют временный доступ к объектам в хранилище.
Выбор механизма контроля доступа зависит от ситуации и желаемого уровня безопасности.

## Метаданные объекта в хранилище

Метаданные объекта в хранилище представляют собой сведения о его свойствах. Метаданные делятся на пользовательские и системные.

### Системные метаданные
Системные метаданные устанавливаются сервисом.

### Пользовательские метаданные
Пользовательские метаданные добавляются и изменяются пользователем.

### Использование метаданных
Метаданные используются для сортировки, анализа и поиска объектов.

### Передача пользовательских метаданных
Пользовательские метаданные передаются в хранилище при загрузке объекта в HTTP-заголовках.

### Имена пользовательских метаданных
Имена пользовательских метаданных могут быть указаны в разных регистрах, но после загрузки в хранилище они становятся строчными.

### Добавление и изменение пользовательских метаданных
Пользовательские метаданные могут быть добавлены или изменены.


# Загрузка файлов в Yandex Object Storage

## Через консоль управления

1. **Перейдите в Yandex.Cloud Console:**
    - Откройте [Yandex.Cloud Console](https://cloud.yandex.ru/).

2. **Откройте раздел Object Storage:**
    - В главном меню выберите `Storage` и перейдите в `Object Storage`.

3. **Выберите бакет:**
    - Нажмите на название бакета, в который вы хотите загрузить файлы.

4. **Загрузите файлы:**
    - Нажмите на кнопку "Загрузить".
    - Выберите файлы или папки для загрузки.
    - Подтвердите выбор, нажав "Открыть" (или аналогичную кнопку в зависимости от браузера).
    - Дождитесь завершения загрузки. Вы увидите статус загрузки в интерфейсе консоли.

## Через утилиту S3cmd

### Установка и настройка S3cmd

1. **Установите утилиту S3cmd:**
    - На системах на базе Debian/Ubuntu выполните:
      ```bash
      sudo apt-get install s3cmd
      ```
    - Для других систем следуйте [инструкциям на официальном сайте S3cmd](https://s3cmd.org/).

2. **Настройте S3cmd:**
    - Запустите команду настройки:
      ```bash
      s3cmd --configure
      ```
    - Введите ваш `Access Key` и `Secret Key` от Yandex Object Storage.
    - Укажите URL сервиса Yandex Object Storage:
      ```text
      https://storage.yandexcloud.net
      ```
    - Завершите настройку, следуя инструкциям на экране.

### Загрузка файлов

1. **Загрузите файл:**
    - Используйте команду `put` для загрузки файла:
      ```bash
      s3cmd put <путь_к_локальному_файлу> s3://<имя_вашего_бакета>/
      ```
    - Пример:
      ```bash
      s3cmd put /home/user/myfile.txt s3://mybucket/
      ```

2. **Загрузка папки:**
    - Чтобы загрузить папку и все её содержимое, используйте параметр `--recursive`:
      ```bash
      s3cmd put --recursive <путь_к_папке> s3://<имя_вашего_бакета>/
      ```
    - Пример:
      ```bash
      s3cmd put --recursive /home/user/myfolder/ s3://mybucket/
      ```

### Проверка статуса загрузки

1. **Просмотр информации о загруженных объектах:**
    - Используйте команду `ls` для просмотра содержимого бакета:
      ```bash
      s3cmd ls s3://<имя_вашего_бакета>/
      ```
    - Пример:
      ```bash
      s3cmd ls s3://mybucket/
      ```

2. **Получение информации о конкретном объекте:**
    - Используйте команду `info`:
      ```bash
      s3cmd info s3://<имя_вашего_бакета>/<имя_файла>
      ```
    - Пример:
      ```bash
      s3cmd info s3://mybucket/myfile.txt
      ```

# Резервное копирование файлов в Yandex Object Storage

Резервное копирование файлов в объектном хранилище важно для обеспечения их надежного хранения. В случае длительных перебоев с доступом к интернету, стоит предусмотреть резервную копию файлов. В Yandex Object Storage нет собственных инструментов для резервного копирования, но существуют поддерживаемые решения.

## Поддерживаемые инструменты для резервного копирования

### Консольные клиенты

1. **S3cmd**
    - S3cmd позволяет синхронизировать содержимое бакета с папкой на компьютере или между двумя бакетами.
    - Команда для синхронизации содержимого бакета с локальной папкой:
      ```bash
      s3cmd sync s3://<имя_вашего_бакета>/ <путь_к_локальной_папке>/
      ```
    - Команда для синхронизации локальной папки с бакетом:
      ```bash
      s3cmd sync <путь_к_локальной_папке>/ s3://<имя_вашего_бакета>/
      ```

2. **AWS CLI**
    - AWS CLI также поддерживает синхронизацию содержимого бакета.
    - Команда для синхронизации содержимого бакета с локальной папкой:
      ```bash
      aws s3 sync s3://<имя_вашего_бакета>/ <путь_к_локальной_папке>
      ```
    - Команда для синхронизации локальной папки с бакетом:
      ```bash
      aws s3 sync <путь_к_локальной_папке> s3://<имя_вашего_бакета>/
      ```

### Файловые менеджеры с графическим интерфейсом

1. **Cyberduck**
    - Cyberduck предоставляет графический интерфейс для управления объектным хранилищем и позволяет удобно загружать и скачивать файлы.
    - Для резервного копирования с помощью Cyberduck просто перетащите файлы из бакета на локальный компьютер или наоборот.

2. **WinSCP**
    - WinSCP работает с объектным хранилищем как с иерархической файловой системой, что облегчает автоматизацию резервного копирования.
    - Для подключения к Yandex Object Storage с помощью WinSCP выполните следующие шаги:

        1. **Создание соединения:**
            - Откройте WinSCP и выберите "Создать новое соединение".
            - Введите параметры подключения:
                - **Протокол:** S3
                - **Хост:** `storage.yandexcloud.net`
                - **Access Key:** <Ваш Access Key>
                - **Secret Key:** <Ваш Secret Key>
            - Нажмите "Сохранить" для создания соединения.

        2. **Автоматизация резервного копирования:**
            - Вы можете использовать встроенный редактор скриптов в WinSCP для создания и автоматизации задач резервного копирования.
            - Пример скрипта для скачивания всех файлов из бакета на локальный компьютер:
              ```bash
              open s3://<имя_вашего_бакета>/
              synchronize local <путь_к_локальной_папке>/
              close
              exit
              ```
            - Сохраните скрипт и настройте расписание для его выполнения.


